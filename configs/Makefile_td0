all:

TD1_MASK ?= 0x1

install_driver:
	sudo ./scripts/mod_switch.sh

run_td1:
	sudo ./scripts/mod_switch.sh && \
	taskset $(TD1_MASK) \
	qemu-system-x86_64 \
	-kernel vms/bzImage \
	-nographic \
	-enable-kvm -m 100 \
	-bios vms/bios.bin \
	-chardev file,path="/tyche/chardev/seabios",id=seabios -device isa-debugcon,iobase=0x402,chardev=seabios \
	-append "noapic lpj=24000000 earlyprintk=serial,tty0 console=ttyS0" 

regression:
	sudo ./scripts/mod_switch.sh
	sudo ./programs/sdk_tyche/app_selector
	sudo ./programs/sdk_tyche/application_with_sandbox
	sudo ./programs/sdk_kvm/app_selector
	sudo ./programs/sdk_kvm/application_with_sandbox

gramine:
	cd /home/dev/Documents/gramine/CI-Examples/helloworld && sudo /gramine-install/gramine-tyche helloworld

gramine-dbg:
	cd /home/dev/Documents/gramine/CI-Examples/helloworld && sudo GDB=1 /gramine-install/gramine-tyche helloworld

gramine-strace:
	cd /home/dev/Documents/gramine/CI-Examples/helloworld && sudo strace -o /tmp/gramout.txt /gramine-install/gramine-tyche helloworld

gramine-hellocpp:
	cd /home/dev/Documents/gramine/CI-Examples/hellocpp && sudo /gramine-install/gramine-tyche helloworld
